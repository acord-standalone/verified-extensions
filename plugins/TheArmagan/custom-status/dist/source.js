(function (extension, common, events, utils, ui) {
  'use strict';

  function _interopDefaultLegacy (e) { return e && typeof e === 'object' && 'default' in e ? e : { 'default': e }; }

  var events__default = /*#__PURE__*/_interopDefaultLegacy(events);
  var utils__default = /*#__PURE__*/_interopDefaultLegacy(utils);
  var ui__default = /*#__PURE__*/_interopDefaultLegacy(ui);

  let checkVar = null;
  let assets = [];
  async function updateActivity() {
    let settings = extension.persist.ghost.settings || {};
    if (checkVar !== `${settings.application_id}-${settings.large_image || ""}-${settings.small_image || ""}`) {
      checkVar = `${settings.application_id}-${settings.large_image || ""}-${settings.small_image || ""}`;
      let req = await fetch(`https://discord.com/api/oauth2/applications/${settings.application_id}/assets`);
      if (req.ok) {
        assets = await req.json();
      } else {
        ui__default["default"].toasts.show.error("[Custom Status] Invalid application id.");
      }
    }
    let activity = {
      name: settings.name || "Acord",
      application_id: settings.application_id,
      type: settings.type || 0,
      flags: 1,
      details: settings.details,
      state: settings.state
    };
    if (settings.button_1_text || settings.button_2_text) {
      activity.buttons = [
        settings.button_1_text?.trim(),
        settings.button_2_text?.trim()
      ].filter((x) => x);
      activity.metadata = {
        button_urls: [
          settings.button_1_url?.trim(),
          settings.button_2_url?.trim()
        ].filter((x) => x)
      };
    }
    if (typeof settings.start_timestamp !== "undefined" || typeof settings.end_timestamp !== "undefined") {
      activity.timestamps = {
        start: settings.start_timestamp?.trim() ? Number(settings.start_timestamp.trim()) : void 0,
        end: settings.end_timestamp?.trim() ? Number(settings.end_timestamp.trim()) : void 0
      };
    }
    if (assets.length && (settings.large_image || settings.small_image)) {
      activity.assets = {};
      if (settings.large_image) {
        activity.assets.large_image = assets.find((i) => i.name === settings.large_image)?.id || settings.large_image;
        activity.assets.large_text = settings.large_text || void 0;
      }
      if (settings.small_image) {
        activity.assets.small_image = assets.find((i) => i.name === settings.small_image)?.id || settings.small_image;
        activity.assets.small_text = settings.small_text || void 0;
      }
    }
    common.FluxDispatcher.dispatch({
      type: "LOCAL_ACTIVITY_UPDATE",
      activity,
      socketId: "rest.armagan.acord"
    });
  }
  const debouncedUpdateActivity = _.debounce(updateActivity, 2500);
  var index = {
    load() {
      updateActivity();
      extension.subscriptions.push(
        events__default["default"].on("CurrentUserChange", updateActivity),
        utils__default["default"].interval(updateActivity, 5e3)
      );
    },
    unload() {
      common.FluxDispatcher.dispatch({
        type: "LOCAL_ACTIVITY_UPDATE",
        activity: {},
        socketId: "rest.armagan.acord"
      });
      checkVar = null;
      assets = [];
    },
    config() {
      debouncedUpdateActivity();
    }
  };

  return index;

})($acord.extension, $acord.modules.common, $acord.events, $acord.utils, $acord.ui);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic291cmNlLmpzIiwic291cmNlcyI6WyIuLi9zcmMvaW5kZXguanMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgc3Vic2NyaXB0aW9ucywgcGVyc2lzdCB9IGZyb20gXCJAYWNvcmQvZXh0ZW5zaW9uXCI7XHJcbmltcG9ydCB7IEZsdXhEaXNwYXRjaGVyIH0gZnJvbSBcIkBhY29yZC9tb2R1bGVzL2NvbW1vblwiO1xyXG5pbXBvcnQgZXZlbnRzIGZyb20gXCJAYWNvcmQvZXZlbnRzXCI7XHJcbmltcG9ydCB1dGlscyBmcm9tIFwiQGFjb3JkL3V0aWxzXCI7XHJcbmltcG9ydCB1aSBmcm9tIFwiQGFjb3JkL3VpXCI7XHJcblxyXG5sZXQgY2hlY2tWYXIgPSBudWxsO1xyXG5sZXQgYXNzZXRzID0gW107XHJcblxyXG5hc3luYyBmdW5jdGlvbiB1cGRhdGVBY3Rpdml0eSgpIHtcclxuICBsZXQgc2V0dGluZ3MgPSBwZXJzaXN0Lmdob3N0LnNldHRpbmdzIHx8IHt9O1xyXG5cclxuICBpZiAoY2hlY2tWYXIgIT09IGAke3NldHRpbmdzLmFwcGxpY2F0aW9uX2lkfS0ke3NldHRpbmdzLmxhcmdlX2ltYWdlIHx8IFwiXCJ9LSR7c2V0dGluZ3Muc21hbGxfaW1hZ2UgfHwgXCJcIn1gKSB7XHJcbiAgICBjaGVja1ZhciA9IGAke3NldHRpbmdzLmFwcGxpY2F0aW9uX2lkfS0ke3NldHRpbmdzLmxhcmdlX2ltYWdlIHx8IFwiXCJ9LSR7c2V0dGluZ3Muc21hbGxfaW1hZ2UgfHwgXCJcIn1gO1xyXG4gICAgbGV0IHJlcSA9IGF3YWl0IGZldGNoKGBodHRwczovL2Rpc2NvcmQuY29tL2FwaS9vYXV0aDIvYXBwbGljYXRpb25zLyR7c2V0dGluZ3MuYXBwbGljYXRpb25faWR9L2Fzc2V0c2ApO1xyXG4gICAgaWYgKHJlcS5vaykge1xyXG4gICAgICBhc3NldHMgPSBhd2FpdCByZXEuanNvbigpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgdWkudG9hc3RzLnNob3cuZXJyb3IoXCJbQ3VzdG9tIFN0YXR1c10gSW52YWxpZCBhcHBsaWNhdGlvbiBpZC5cIik7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBsZXQgYWN0aXZpdHkgPSB7XHJcbiAgICBuYW1lOiBzZXR0aW5ncy5uYW1lIHx8IFwiQWNvcmRcIixcclxuICAgIGFwcGxpY2F0aW9uX2lkOiBzZXR0aW5ncy5hcHBsaWNhdGlvbl9pZCxcclxuICAgIHR5cGU6IHNldHRpbmdzLnR5cGUgfHwgMCxcclxuICAgIGZsYWdzOiAxLFxyXG4gICAgZGV0YWlsczogc2V0dGluZ3MuZGV0YWlscyxcclxuICAgIHN0YXRlOiBzZXR0aW5ncy5zdGF0ZSxcclxuICB9O1xyXG5cclxuICBpZiAoc2V0dGluZ3MuYnV0dG9uXzFfdGV4dCB8fCBzZXR0aW5ncy5idXR0b25fMl90ZXh0KSB7XHJcbiAgICBhY3Rpdml0eS5idXR0b25zID0gW1xyXG4gICAgICBzZXR0aW5ncy5idXR0b25fMV90ZXh0Py50cmltKCksXHJcbiAgICAgIHNldHRpbmdzLmJ1dHRvbl8yX3RleHQ/LnRyaW0oKSxcclxuICAgIF0uZmlsdGVyKCh4KSA9PiB4KTtcclxuXHJcbiAgICBhY3Rpdml0eS5tZXRhZGF0YSA9IHtcclxuICAgICAgYnV0dG9uX3VybHM6IFtcclxuICAgICAgICBzZXR0aW5ncy5idXR0b25fMV91cmw/LnRyaW0oKSxcclxuICAgICAgICBzZXR0aW5ncy5idXR0b25fMl91cmw/LnRyaW0oKSxcclxuICAgICAgXS5maWx0ZXIoKHgpID0+IHgpLFxyXG4gICAgfTtcclxuICB9XHJcblxyXG4gIGlmICh0eXBlb2Ygc2V0dGluZ3Muc3RhcnRfdGltZXN0YW1wICE9PSBcInVuZGVmaW5lZFwiIHx8IHR5cGVvZiBzZXR0aW5ncy5lbmRfdGltZXN0YW1wICE9PSBcInVuZGVmaW5lZFwiKSB7XHJcbiAgICBhY3Rpdml0eS50aW1lc3RhbXBzID0ge1xyXG4gICAgICBzdGFydDogc2V0dGluZ3Muc3RhcnRfdGltZXN0YW1wPy50cmltKCkgPyBOdW1iZXIoc2V0dGluZ3Muc3RhcnRfdGltZXN0YW1wLnRyaW0oKSkgOiB1bmRlZmluZWQsXHJcbiAgICAgIGVuZDogc2V0dGluZ3MuZW5kX3RpbWVzdGFtcD8udHJpbSgpID8gTnVtYmVyKHNldHRpbmdzLmVuZF90aW1lc3RhbXAudHJpbSgpKSA6IHVuZGVmaW5lZCxcclxuICAgIH07XHJcbiAgfVxyXG5cclxuICBpZiAoYXNzZXRzLmxlbmd0aCAmJiAoc2V0dGluZ3MubGFyZ2VfaW1hZ2UgfHwgc2V0dGluZ3Muc21hbGxfaW1hZ2UpKSB7XHJcblxyXG4gICAgYWN0aXZpdHkuYXNzZXRzID0ge307XHJcblxyXG4gICAgaWYgKHNldHRpbmdzLmxhcmdlX2ltYWdlKSB7XHJcbiAgICAgIGFjdGl2aXR5LmFzc2V0cy5sYXJnZV9pbWFnZSA9IGFzc2V0cy5maW5kKGkgPT4gaS5uYW1lID09PSBzZXR0aW5ncy5sYXJnZV9pbWFnZSk/LmlkIHx8IHNldHRpbmdzLmxhcmdlX2ltYWdlO1xyXG4gICAgICBhY3Rpdml0eS5hc3NldHMubGFyZ2VfdGV4dCA9IHNldHRpbmdzLmxhcmdlX3RleHQgfHwgdW5kZWZpbmVkO1xyXG4gICAgfVxyXG5cclxuICAgIGlmIChzZXR0aW5ncy5zbWFsbF9pbWFnZSkge1xyXG4gICAgICBhY3Rpdml0eS5hc3NldHMuc21hbGxfaW1hZ2UgPSBhc3NldHMuZmluZChpID0+IGkubmFtZSA9PT0gc2V0dGluZ3Muc21hbGxfaW1hZ2UpPy5pZCB8fCBzZXR0aW5ncy5zbWFsbF9pbWFnZTtcclxuICAgICAgYWN0aXZpdHkuYXNzZXRzLnNtYWxsX3RleHQgPSBzZXR0aW5ncy5zbWFsbF90ZXh0IHx8IHVuZGVmaW5lZDtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIEZsdXhEaXNwYXRjaGVyLmRpc3BhdGNoKHtcclxuICAgIHR5cGU6IFwiTE9DQUxfQUNUSVZJVFlfVVBEQVRFXCIsXHJcbiAgICBhY3Rpdml0eSxcclxuICAgIHNvY2tldElkOiBcInJlc3QuYXJtYWdhbi5hY29yZFwiLFxyXG4gIH0pO1xyXG59XHJcblxyXG5jb25zdCBkZWJvdW5jZWRVcGRhdGVBY3Rpdml0eSA9IF8uZGVib3VuY2UodXBkYXRlQWN0aXZpdHksIDI1MDApO1xyXG5cclxuZXhwb3J0IGRlZmF1bHQge1xyXG4gIGxvYWQoKSB7XHJcbiAgICB1cGRhdGVBY3Rpdml0eSgpO1xyXG5cclxuICAgIHN1YnNjcmlwdGlvbnMucHVzaChcclxuICAgICAgZXZlbnRzLm9uKFwiQ3VycmVudFVzZXJDaGFuZ2VcIiwgdXBkYXRlQWN0aXZpdHkpLFxyXG4gICAgICB1dGlscy5pbnRlcnZhbCh1cGRhdGVBY3Rpdml0eSwgNTAwMClcclxuICAgICk7XHJcbiAgfSxcclxuICB1bmxvYWQoKSB7XHJcbiAgICBGbHV4RGlzcGF0Y2hlci5kaXNwYXRjaCh7XHJcbiAgICAgIHR5cGU6IFwiTE9DQUxfQUNUSVZJVFlfVVBEQVRFXCIsXHJcbiAgICAgIGFjdGl2aXR5OiB7fSxcclxuICAgICAgc29ja2V0SWQ6IFwicmVzdC5hcm1hZ2FuLmFjb3JkXCJcclxuICAgIH0pO1xyXG4gICAgY2hlY2tWYXIgPSBudWxsO1xyXG4gICAgYXNzZXRzID0gW107XHJcbiAgfSxcclxuICBjb25maWcoKSB7XHJcbiAgICBkZWJvdW5jZWRVcGRhdGVBY3Rpdml0eSgpO1xyXG4gIH1cclxufSJdLCJuYW1lcyI6WyJwZXJzaXN0IiwidWkiLCJGbHV4RGlzcGF0Y2hlciIsInN1YnNjcmlwdGlvbnMiLCJldmVudHMiLCJ1dGlscyJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7O0VBS0EsSUFBSSxRQUFRLEdBQUcsSUFBSSxDQUFDO0VBQ3BCLElBQUksTUFBTSxHQUFHLEVBQUUsQ0FBQztFQUNoQixlQUFlLGNBQWMsR0FBRztFQUNoQyxFQUFFLElBQUksUUFBUSxHQUFHQSxpQkFBTyxDQUFDLEtBQUssQ0FBQyxRQUFRLElBQUksRUFBRSxDQUFDO0VBQzlDLEVBQUUsSUFBSSxRQUFRLEtBQUssQ0FBQyxFQUFFLFFBQVEsQ0FBQyxjQUFjLENBQUMsQ0FBQyxFQUFFLFFBQVEsQ0FBQyxXQUFX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
