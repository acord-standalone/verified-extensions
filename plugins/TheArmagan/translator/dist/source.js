(function(p,U,H,I,k,q,$){"use strict";function w(r){return r&&typeof r=="object"&&"default"in r?r:{default:r}}var F=w(U),G=w(H),g=w(I),T=w(k),C=w(q),B=w($),_=[{value:"af",label:"Afrikaans"},{value:"sq",label:"Albanian"},{value:"de",label:"German"},{value:"ar",label:"Arabic"},{value:"bn",label:"Bengali"},{value:"my",label:"Burmese"},{value:"bs",label:"Bosnian"},{value:"bg",label:"Bulgarian"},{value:"km",label:"Cambodian"},{value:"kn",label:"Kannada"},{value:"ca",label:"Catalan"},{value:"cs",label:"Czech"},{value:"zh",label:"Simplified Chinese"},{value:"zh-TW",label:"Traditional Chinese"},{value:"si",label:"Sinhalese"},{value:"ko",label:"Korean"},{value:"hr",label:"Croatian"},{value:"da",label:"Danish"},{value:"sk",label:"Slovak"},{value:"es",label:"Spanish"},{value:"et",label:"Estonian"},{value:"fi",label:"Finnish"},{value:"fr",label:"French"},{value:"el",label:"Greek"},{value:"gu",label:"Gujarati"},{value:"hi",label:"Hindi"},{value:"nl",label:"Dutch"},{value:"hu",label:"Hungarian"},{value:"id",label:"Indonesian"},{value:"en",label:"English"},{value:"is",label:"Icelandic"},{value:"it",label:"Italian"},{value:"ja",label:"Japanese"},{value:"la",label:"Latin"},{value:"lv",label:"Latvian"},{value:"ml",label:"Malayalam"},{value:"ms",label:"Malay"},{value:"mr",label:"Marathi"},{value:"ne",label:"Nepali"},{value:"no",label:"Norwegian"},{value:"pl",label:"Polish"},{value:"pt",label:"Portuguese"},{value:"ro",label:"Romanian"},{value:"ru",label:"Russian"},{value:"sr",label:"Serbian"},{value:"sw",label:"Swahili"},{value:"sv",label:"Swedish"},{value:"su",label:"Sundanese"},{value:"tl",label:"Tagalog"},{value:"th",label:"Thai"},{value:"ta",label:"Tamil"},{value:"te",label:"Telugu"},{value:"tr",label:"Turkish"},{value:"uk",label:"Ukrainian"},{value:"ur",label:"Urdu"},{value:"vi",label:"Vietnamese"}],N=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},L={exports:{}};(function(r,e){var a=function(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof N<"u")return N;throw new Error("unable to locate global object")},t=a();r.exports=e=t.fetch,t.fetch&&(e.default=t.fetch.bind(t)),e.Headers=t.Headers,e.Request=t.Request,e.Response=t.Response})(L,L.exports);var D=L.exports,P={exports:{}};/*!
* depd
* Copyright(c) 2015 Douglas Christopher Wilson
* MIT Licensed
*/var V=z;function z(r){if(!r)throw new TypeError("argument namespace is required");function e(a){}return e._file=void 0,e._ignored=!0,e._namespace=r,e._traced=!1,e._warned=Object.create(null),e.function=K,e.property=Z,e}function K(r,e){if(typeof r!="function")throw new TypeError("argument fn must be a function");return r}function Z(r,e,a){if(!r||typeof r!="object"&&typeof r!="function")throw new TypeError("argument obj must be object");var t=Object.getOwnPropertyDescriptor(r,e);if(!t)throw new TypeError("must call property on owner object");if(!t.configurable)throw new TypeError("property must be configurable")}var W=Object.setPrototypeOf||({__proto__:[]}instanceof Array?J:Q);function J(r,e){return r.__proto__=e,r}function Q(r,e){for(var a in e)Object.prototype.hasOwnProperty.call(r,a)||(r[a]=e[a]);return r}var X={100:"Continue",101:"Switching Protocols",102:"Processing",103:"Early Hints",200:"OK",201:"Created",202:"Accepted",203:"Non-Authoritative Information",204:"No Content",205:"Reset Content",206:"Partial Content",207:"Multi-Status",208:"Already Reported",226:"IM Used",300:"Multiple Choices",301:"Moved Permanently",302:"Found",303:"See Other",304:"Not Modified",305:"Use Proxy",307:"Temporary Redirect",308:"Permanent Redirect",400:"Bad Request",401:"Unauthorized",402:"Payment Required",403:"Forbidden",404:"Not Found",405:"Method Not Allowed",406:"Not Acceptable",407:"Proxy Authentication Required",408:"Request Timeout",409:"Conflict",410:"Gone",411:"Length Required",412:"Precondition Failed",413:"Payload Too Large",414:"URI Too Long",415:"Unsupported Media Type",416:"Range Not Satisfiable",417:"Expectation Failed",418:"I'm a Teapot",421:"Misdirected Request",422:"Unprocessable Entity",423:"Locked",424:"Failed Dependency",425:"Too Early",426:"Upgrade Required",428:"Precondition Required",429:"Too Many Requests",431:"Request Header Fields Too Large",451:"Unavailable For Legal Reasons",500:"Internal Server Error",501:"Not Implemented",502:"Bad Gateway",503:"Service Unavailable",504:"Gateway Timeout",505:"HTTP Version Not Supported",506:"Variant Also Negotiates",507:"Insufficient Storage",508:"Loop Detected",509:"Bandwidth Limit Exceeded",510:"Not Extended",511:"Network Authentication Required"};/*!
* statuses
* Copyright(c) 2014 Jonathan Ong
* Copyright(c) 2016 Douglas Christopher Wilson
* MIT Licensed
*/var O=X,Y=v;v.message=O,v.code=ee(O),v.codes=te(O),v.redirect={300:!0,301:!0,302:!0,303:!0,305:!0,307:!0,308:!0},v.empty={204:!0,205:!0,304:!0},v.retry={502:!0,503:!0,504:!0};function ee(r){var e={};return Object.keys(r).forEach(function(t){var u=r[t],s=Number(t);e[u.toLowerCase()]=s}),e}function te(r){return Object.keys(r).map(function(a){return Number(a)})}function re(r){var e=r.toLowerCase();if(!Object.prototype.hasOwnProperty.call(v.code,e))throw new Error('invalid status message: "'+r+'"');return v.code[e]}function S(r){if(!Object.prototype.hasOwnProperty.call(v.message,r))throw new Error("invalid status code: "+r);return v.message[r]}function v(r){if(typeof r=="number")return S(r);if(typeof r!="string")throw new TypeError("code must be a number or string");var e=parseInt(r,10);return isNaN(e)?re(r):S(e)}var x={exports:{}};typeof Object.create=="function"?x.exports=function(e,a){a&&(e.super_=a,e.prototype=Object.create(a.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}))}:x.exports=function(e,a){if(a){e.super_=a;var t=function(){};t.prototype=a.prototype,e.prototype=new t,e.prototype.constructor=e}};/*!
* toidentifier
* Copyright(c) 2016 Douglas Christopher Wilson
* MIT Licensed
*/var ae=ne;function ne(r){return r.split(" ").map(function(e){return e.slice(0,1).toUpperCase()+e.slice(1)}).join("").replace(/[^ _0-9a-z]/gi,"")}/*!
* http-errors
* Copyright(c) 2014 Jonathan Ong
* Copyright(c) 2016 Douglas Christopher Wilson
* MIT Licensed
*/(function(r){V("http-errors");var e=W,a=Y,t=x.exports,u=ae;r.exports=i,r.exports.HttpError=b(),r.exports.isHttpError=ie(r.exports.HttpError),pe(r.exports,a.codes,r.exports.HttpError);function s(o){return Number(String(o).charAt(0)+"00")}function i(){for(var o,m,n=500,y={},l=0;l<arguments.length;l++){var c=arguments[l],d=typeof c;if(d==="object"&&c instanceof Error)o=c,n=o.status||o.statusCode||n;else if(d==="number"&&l===0)n=c;else if(d==="string")m=c;else if(d==="object")y=c;else throw new TypeError("argument #"+(l+1)+" unsupported type "+d)}(typeof n!="number"||!a.message[n]&&(n<400||n>=600))&&(n=500);var f=i[n]||i[s(n)];o||(o=f?new f(m):new Error(m||a.message[n]),Error.captureStackTrace(o,i)),(!f||!(o instanceof f)||o.status!==n)&&(o.expose=n<500,o.status=o.statusCode=n);for(var E in y)E!=="status"&&E!=="statusCode"&&(o[E]=y[E]);return o}function b(){function o(){throw new TypeError("cannot construct abstract class")}return t(o,Error),o}function h(o,m,n){var y=A(m);function l(c){var d=c??a.message[n],f=new Error(d);return Error.captureStackTrace(f,l),e(f,l.prototype),Object.defineProperty(f,"message",{enumerable:!0,configurable:!0,value:d,writable:!0}),Object.defineProperty(f,"name",{enumerable:!1,configurable:!0,value:y,writable:!0}),f}return t(l,o),j(l,y),l.prototype.status=n,l.prototype.statusCode=n,l.prototype.expose=!0,l}function ie(o){return function(n){return!n||typeof n!="object"?!1:n instanceof o?!0:n instanceof Error&&typeof n.expose=="boolean"&&typeof n.statusCode=="number"&&n.status===n.statusCode}}function ce(o,m,n){var y=A(m);function l(c){var d=c??a.message[n],f=new Error(d);return Error.captureStackTrace(f,l),e(f,l.prototype),Object.defineProperty(f,"message",{enumerable:!0,configurable:!0,value:d,writable:!0}),Object.defineProperty(f,"name",{enumerable:!1,configurable:!0,value:y,writable:!0}),f}return t(l,o),j(l,y),l.prototype.status=n,l.prototype.statusCode=n,l.prototype.expose=!1,l}function j(o,m){var n=Object.getOwnPropertyDescriptor(o,"name");n&&n.configurable&&(n.value=m,Object.defineProperty(o,"name",n))}function pe(o,m,n){m.forEach(function(l){var c,d=u(a.message[l]);switch(s(l)){case 400:c=h(n,d,l);break;case 500:c=ce(n,d,l);break}c&&(o[l]=c,o[d]=c)})}function A(o){return o.substr(-5)!=="Error"?o+"Error":o}})(P);var R=P.exports;function oe(r){const e=r.match(/IP address: (.+?)<br>/)?.[1]||"",a=r.match(/Time: (.+?)<br>/)?.[1]||"",t=(r.match(/URL: (.+?)<br>/)?.[1]||"").replace(/&amp;/g,"&");return{ip:e,time:a,url:t}}const le={from:"auto",to:"en",host:"translate.google.com"};async function M(r,e){return new se(r,e).translate()}class se{constructor(e,a){this.inputText=e,this.options=Object.assign({},le,a)}async translate(){const e=this.buildUrl(),a=this.buildFetchOptions(),t=await D(e,a);if(!t.ok)throw await this.buildError(t);const u=await t.json();return{text:this.buildResText(u),raw:u}}buildUrl(){const{host:e}=this.options;return[`https://${e}/translate_a/single`,"?client=at","&dt=t","&dt=rm","&dj=1"].join("")}buildBody(){const{from:e,to:a}=this.options,t={sl:e,tl:a,q:this.inputText};return new URLSearchParams(t).toString()}buildFetchOptions(){const{fetchOptions:e}=this.options,a=Object.assign({},e);return a.method="POST",a.headers=Object.assign({},a.headers,{"Content-Type":"application/x-www-form-urlencoded;charset=utf-8"}),a.body=this.buildBody(),a}buildResText({sentences:e}){return e.filter(a=>"trans"in a).map(a=>a.trans).join("")}async buildError(e){if(e.status===429){const a=await e.text(),{ip:t,time:u,url:s}=oe(a),i=`${e.statusText} IP: ${t}, Time: ${u}, Url: ${s}`;return R(e.status,i)}else return R(e.status,e.statusText)}}var ue={load(){function r(t){T.default.react.forceUpdate(T.default.react.getInstance(t))}async function e(t,u,s){p.persist.store.lastUsedToLang=s;let{text:i}=await M(u,{to:s});t.content=i}function a(t,u){(!t.__original_content__||t.__original_content__.time!==(t.editedTimestamp?Number(t.editedTimestamp):Number(t.timestamp)))&&(t.__original_content__={text:t.content,time:t.editedTimestamp?Number(t.editedTimestamp):Number(t.timestamp)});let s=t.__original_content__.text,i=p.persist.ghost.lastUsedToLang||"en",b=B.default.locale.split("-")[0];return[{label:p.i18n.format("SHOW_ORIGINAL"),disabled:t.content===s,action:()=>{t.content=s,r(u)}},{label:p.i18n.format("TRANSLATE_TO"),type:"submenu",items:[i===b?null:{label:_.find(h=>h.value===i)?.label||i,action:()=>e(t,s,i)},{label:_.find(h=>h.value===b)?.label||b,action:()=>e(t,s,b)},{label:p.i18n.format("ALL_LANGUAGES"),type:"submenu",items:_.map(h=>({label:h.label,action:()=>e(t,s,h.value)}))}].filter(h=>h)}]}p.subscriptions.push(g.default.messageButtons.patch({icon:`
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
              <path fill="currentColor" d="M18.5 10L22.9 21H20.745L19.544 18H15.454L14.255 21H12.101L16.5 10H18.5ZM10 2V4H16V6L14.0322 6.0006C13.2425 8.36616 11.9988 10.5057 10.4115 12.301C11.1344 12.9457 11.917 13.5176 12.7475 14.0079L11.9969 15.8855C10.9237 15.2781 9.91944 14.5524 8.99961 13.7249C7.21403 15.332 5.10914 16.5553 2.79891 17.2734L2.26257 15.3442C4.2385 14.7203 6.04543 13.6737 7.59042 12.3021C6.46277 11.0281 5.50873 9.57985 4.76742 8.00028L7.00684 8.00037C7.57018 9.03885 8.23979 10.0033 8.99967 10.877C10.2283 9.46508 11.2205 7.81616 11.9095 6.00101L2 6V4H8V2H10ZM17.5 12.8852L16.253 16H18.745L17.5 12.8852Z"></path>
            </svg>
          `,position:"start",get tooltip(){return p.i18n.format("TRANSLATE")},predicate(t){let u=C.default.parents(t,".message__80c10").pop();return T.default.react.getProps(u,i=>i?.message)?.message?.content?.length>0},action(t){let u=C.default.parents(t.target,".message__80c10").pop(),s=T.default.react.getProps(u,i=>i?.message)?.message;!s||g.default.contextMenus.open(t,g.default.contextMenus.build.menu(a(s,u)))}}),g.default.contextMenus.patch("message",(t,u)=>{!u?.message||t.props.children.push(g.default.contextMenus.build.item({type:"separator"}),g.default.contextMenus.build.item({label:p.i18n.format("PLUGIN_NAME"),type:"submenu",items:a(u.message,C.default.parents(u.target,".message-2CShn3").pop())}))}),g.default.contextMenus.patch("textarea-context",(t,u)=>{let s=p.persist.ghost.autoTranslate??!1,i=p.persist.ghost.autoTranslateTo??"en";t.props.children.push(g.default.contextMenus.build.item({type:"separator"}),g.default.contextMenus.build.item({label:p.i18n.format("PLUGIN_NAME"),type:"submenu",items:[{type:"toggle",label:p.i18n.format("AUTO_TRANSLATE"),checked:s,action(){s=!s,p.persist.store.autoTranslate=s}},{type:"submenu",label:p.i18n.format("TRANSLATE_TO"),items:_.map(b=>({label:b.label,action:()=>{p.persist.store.autoTranslateTo=b.value},group:"auto-translate-to",type:"radio",checked:i===b.value}))}]}))}),G.default.instead("sendMessage",F.default.MessageActions,async function(t,u){if(!(p.persist.ghost.autoTranslate??!1))return u.call(this,...t);let i=p.persist.ghost.autoTranslateTo??"en";if(t[1]&&t[1].content){let{text:b}=await M(t[1].content,{to:i});t[1].content=b}return u.call(this,...t)}))},unload(){}};return ue})($acord.extension,$acord.modules.common,$acord.patcher,$acord.ui,$acord.utils,$acord.dom,$acord.i18n);
