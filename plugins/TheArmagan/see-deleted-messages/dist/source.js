(function(r,g,h,l,n){"use strict";function i(t){return t&&typeof t=="object"&&"default"in t?t:{default:t}}var c=i(g),E=i(h),f={load(){let t=new Map;r.subscriptions.push(()=>{t.forEach((e,a)=>{n.FluxDispatcher.dispatch({type:"MESSAGE_DELETE",...e,__original__:!0})}),t.clear()});function u(e){let a=e.id.split("-").pop();if(t.has(a))return e.style.backgroundColor="rgba(255,0,0,0.1)",()=>{e.style.backgroundColor=""};e.style.backgroundColor=""}function d(){document.querySelectorAll('[id^="chat-messages-"]').forEach(u)}function o(e){if(!e||(e.flags&64)===64)return!0;let a=n.UserStore.getUser(e.author.id);if(!a||a?.bot)return!0}r.subscriptions.push(E.default.patch('[id^="chat-messages-"]',u),l.contextMenus.patch("message",(e,a)=>{t.has(a.message.id)&&e.props.children.push(l.contextMenus.build.item({type:"separator"}),l.contextMenus.build.item({label:r.i18n.format("DELETE_FROM_ME"),action(){let s=t.get(a.message.id);s&&(n.FluxDispatcher.dispatch({type:"MESSAGE_DELETE",...s,__original__:!0}),t.delete(a.message.id))}}))}),c.default.patch("MESSAGE_DELETE","MessageStore",{actionHandler(e){o(n.MessageStore.getMessage(e.event.channelId,e.event.id))||e.cancel(),delete e.event.type,t.set(e.event.id,e.event),setTimeout(d,0)},storeDidChange(e){e.cancel()}}),c.default.patch("MESSAGE_DELETE_BULK","MessageStore",{actionHandler(e){let a=[];e.event.ids.forEach(s=>{if(o(n.MessageStore.getMessage(e.event.channelId,s)))return a.push(s);t.set(s,{id:s,channelId:e.event.channelId,guildId:e.event.guildId})}),a.length&&n.FluxDispatcher.dispatch({type:"MESSAGE_DELETE_BULK",ids:a,channelId:e.event.channelId,guildId:e.event.guildId,__original__:!0}),setTimeout(d,0),e.cancel()},storeDidChange(e){e.cancel()}}))},unload(){}};return f})($acord.extension,$acord.actionHandlers,$acord.dom,$acord.ui,$acord.modules.common);
